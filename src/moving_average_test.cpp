#include <ibse_testing.h>
#include <ibse_internal.h>
#include <iostream>

int
main()
{
   // Test moving average smoothing function
   Eigen::MatrixXd in(31,1);
   in << -0.024016965262090, -0.024030645539337, -0.119335461093448, -0.161711842253802,
      -0.137702361813770, -0.116699443609580, -0.097266130160307, -0.087580478667415,
      -0.088082766878701, -0.087204833886077, -0.083512989452100, -0.066938046221357,
      -0.044366001479288, -0.021549640492343, -0.004415147850363,  0.001294820623802,
      0.006373378752095,  0.011128497659637,  0.011684531444809,  0.012310407194840,
      0.013120267865501,  0.015753320364320,  0.019305763023424,  0.022860449689303,
      0.024802696561266,  0.023619600413954,  0.021762043380999,  0.020195550277064,
      0.021214836986035,  0.021767983666138,  0.021769011556802;
   
   Eigen::MatrixXd avg =  ibse::movingAverage(in, 15);

   APX_EQ(avg(0, 0), -0.024017);
   APX_EQ(avg(1, 0), -0.0557944);
   APX_EQ(avg(2, 0), -0.0933595);
   APX_EQ(avg(3, 0), -0.0972518);
   APX_EQ(avg(4, 0), -0.0951585);
   APX_EQ(avg(5, 0), -0.0933767);
   APX_EQ(avg(6, 0), -0.0875729);
   APX_EQ(avg(7, 0), -0.0776275);
   APX_EQ(avg(8, 0), -0.0759401);
   APX_EQ(avg(9, 0), -0.0739131);
   APX_EQ(avg(10,0), -0.0652155);
   APX_EQ(avg(11,0), -0.0536558);
   APX_EQ(avg(12,0), -0.0436549);
   APX_EQ(avg(13,0), -0.0350003);
   APX_EQ(avg(14,0), -0.0274656);
   APX_EQ(avg(15,0), -0.0203399);
   APX_EQ(avg(16,0), -0.0129437);
   APX_EQ(avg(17,0), -0.00547651);
   APX_EQ(avg(18,0),  0.00166566);
   APX_EQ(avg(19,0),  0.007579);
   APX_EQ(avg(20,0),  0.0118831);
   APX_EQ(avg(21,0),  0.0147341);
   APX_EQ(avg(22,0),  0.0164796);
   APX_EQ(avg(23,0),  0.0178446);
   APX_EQ(avg(24,0),  0.0192436);
   APX_EQ(avg(25,0),  0.020561);
   APX_EQ(avg(26,0),  0.021922);
   APX_EQ(avg(27,0),  0.0221617);
   APX_EQ(avg(28,0),  0.0213419);
   APX_EQ(avg(29,0),  0.0215839);
   APX_EQ(avg(30,0),  0.021769);
}
